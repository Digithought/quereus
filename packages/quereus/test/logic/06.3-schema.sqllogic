-- schema-indexes.sqllogic - Testing schema() introspection for indexes

CREATE TABLE products (
	id INTEGER PRIMARY KEY,
	name TEXT,
	category TEXT
);

CREATE INDEX idx_category ON products(category);

CREATE INDEX idx_name ON products(name);

-- Verify indexes are returned in schema()
SELECT type, name, tbl_name, sql FROM schema() WHERE type = 'index' ORDER BY name;
→ [{"type":"index","name":"idx_category","tbl_name":"products","sql":"CREATE INDEX \"idx_category\" ON \"products\" (\"category\" COLLATE BINARY)"},{"type":"index","name":"idx_name","tbl_name":"products","sql":"CREATE INDEX \"idx_name\" ON \"products\" (\"name\" COLLATE BINARY)"}]

-- Verify 'index' is in the list of schema object types
SELECT DISTINCT type FROM schema() ORDER BY type;
→ [{"type":"function"},{"type":"index"},{"type":"table"}]

-- Test with composite index
CREATE TABLE orders (
	id INTEGER PRIMARY KEY,
	customer_id INTEGER,
	status TEXT
);

CREATE INDEX idx_customer_status ON orders(customer_id, status);

SELECT name, tbl_name, sql FROM schema() WHERE type = 'index' AND tbl_name = 'orders';
→ [{"name":"idx_customer_status","tbl_name":"orders","sql":"CREATE INDEX \"idx_customer_status\" ON \"orders\" (\"customer_id\" COLLATE BINARY, \"status\" COLLATE BINARY)"}]

-- Test with DESC index
CREATE TABLE events (
	id INTEGER PRIMARY KEY,
	created_at TEXT
);

CREATE INDEX idx_created_desc ON events(created_at DESC);

SELECT sql FROM schema() WHERE type = 'index' AND name = 'idx_created_desc';
→ [{"sql":"CREATE INDEX \"idx_created_desc\" ON \"events\" (\"created_at\" COLLATE BINARY DESC)"}]
