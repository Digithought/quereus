-- error_paths.sqllogic - Testing expected error conditions

-- Syntax Error: Incomplete statement
SELECT * FROM;
-- error: Expected table name. (at line 1, column 14)

-- Syntax Error: Misspelled keyword
CREAT TABLE t_err (a);
-- error: Expected statement type (SELECT, INSERT, UPDATE, DELETE, VALUES, CREATE, etc.), got 'CREAT'. (at line 1, column 1)

-- Semantic Error: Table not found
SELECT * FROM non_existent_table;
-- error: not found in schema path

-- Semantic Error: Column not found
CREATE TABLE t_err_col (a INTEGER);
INSERT INTO t_err_col VALUES (1);
SELECT b FROM t_err_col;
-- error: Column not found: b
DROP TABLE t_err_col;

-- Semantic Error: Ambiguous column
CREATE TABLE t_amb1 (id INTEGER, name TEXT);
CREATE TABLE t_amb2 (id INTEGER, value TEXT);
INSERT INTO t_amb1 VALUES (1, 'A');
INSERT INTO t_amb2 VALUES (1, 'X');
SELECT id FROM t_amb1 JOIN t_amb2 ON t_amb1.id = t_amb2.id;
-- error: ambiguous column name: id
DROP TABLE t_amb1;
DROP TABLE t_amb2;

-- Semantic Success: Qualified columns resolve correctly in JOIN
CREATE TABLE t_qual1 (id INTEGER, name TEXT);
CREATE TABLE t_qual2 (id INTEGER, value TEXT);
INSERT INTO t_qual1 VALUES (1, 'A'), (2, 'B');
INSERT INTO t_qual2 VALUES (1, 'X'), (3, 'Y');
SELECT a.id AS a_id, a.name, b.id AS b_id, b.value FROM t_qual1 a JOIN t_qual2 b ON a.id = b.id ORDER BY a.id;
→ [{"a_id":1,"name":"A","b_id":1,"value":"X"}]
DROP TABLE t_qual1;
DROP TABLE t_qual2;

-- Semantic Success: Projection alias shadows input columns in ORDER BY
CREATE TABLE t_order_shadow (id INTEGER, name TEXT);
INSERT INTO t_order_shadow VALUES (1, 'Z'), (2, 'A'), (3, 'M');
SELECT id AS name, name AS id FROM t_order_shadow ORDER BY name;
→ [{"name":1,"id":"Z"},{"name":2,"id":"A"},{"name":3,"id":"M"}]
SELECT id AS name, name AS id FROM t_order_shadow ORDER BY name DESC;
→ [{"name":3,"id":"M"},{"name":2,"id":"A"},{"name":1,"id":"Z"}]
DROP TABLE t_order_shadow;

-- Semantic Success: CTE name shadows table name
CREATE TABLE t_cte_shadow (id INTEGER, name TEXT);
INSERT INTO t_cte_shadow VALUES (1, 'Table'), (2, 'Data');
WITH t_cte_shadow AS (SELECT 10 AS id, 'CTE' AS name)
SELECT * FROM t_cte_shadow ORDER BY id;
→ [{"id":10,"name":"CTE"}]
SELECT * FROM t_cte_shadow ORDER BY id;
→ [{"id":1,"name":"Table"},{"id":2,"name":"Data"}]
DROP TABLE t_cte_shadow;

-- Semantic Error: Function not found
SELECT non_existent_function(1);
-- error: Function not found: non_existent_function/1

-- Runtime Error: Division by zero (SQLite returns NULL)
SELECT 1 / 0;
→ [{"1 / 0":null}]

-- Runtime Error: CAST behavior (SQLite tries to convert)
SELECT cast(x'01' as INTEGER);
→ [{"cast(x'01' as integer)":0}]

-- Constraint Error: Primary Key Violation (when enforced)
CREATE TABLE t_pk (id INTEGER PRIMARY KEY);
INSERT INTO t_pk VALUES (1);
INSERT INTO t_pk VALUES (1);
-- error: UNIQUE constraint failed: t_pk PK.
DROP TABLE t_pk;

-- Subquery Error: Multiple rows returned where one expected
CREATE TABLE t_sub (id INTEGER, val TEXT);
INSERT INTO t_sub VALUES (1, 'a'), (2, 'b');
SELECT (SELECT val FROM t_sub);
-- error: subquery returned more than 1 row
DROP TABLE t_sub;

-- Type Error: Invalid type conversion in strict context
SELECT CAST('not_a_number' AS INTEGER) WHERE 0;
-- May succeed with value 0 depending on implementation

-- Parse error with location info on multi-line statement
SELECT
  *
  FROM
  WHERE 1;
-- error: Expected table name.

-- NOT NULL constraint via UPDATE to NULL
CREATE TABLE t_nn_upd (id INTEGER PRIMARY KEY, name TEXT);
INSERT INTO t_nn_upd VALUES (1, 'hello');
UPDATE t_nn_upd SET name = NULL WHERE id = 1;
-- error: NOT NULL constraint failed: t_nn_upd.name
DROP TABLE t_nn_upd;

-- CHECK constraint violation
CREATE TABLE t_chk (id INTEGER PRIMARY KEY, val INTEGER CHECK (val > 0));
INSERT INTO t_chk VALUES (1, 10);
INSERT INTO t_chk VALUES (2, -5);
-- error: CHECK constraint failed
DROP TABLE t_chk;

-- Misuse Error: Trying to use closed DB (cannot test directly in sqllogic)

-- Misuse Error: Using finalized statement (cannot test directly in sqllogic)
