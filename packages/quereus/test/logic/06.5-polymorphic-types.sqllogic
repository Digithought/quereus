-- polymorphic-types.sqllogic - Testing polymorphic function type inference

-- Test abs() with INTEGER and REAL types
CREATE TABLE test_abs (id INTEGER PRIMARY KEY, int_val INTEGER, real_val REAL);
INSERT INTO test_abs VALUES (1, -42, -2.5);

SELECT abs(int_val) as result FROM test_abs;
→ [{"result": 42}]

SELECT abs(real_val) as result FROM test_abs;
→ [{"result": 2.5}]

DROP TABLE test_abs;

-- Test coalesce() type inference
SELECT coalesce(NULL, 42) as result;
→ [{"result": 42}]

-- Test greatest() and least()
CREATE TABLE test_minmax (id INTEGER PRIMARY KEY, a INTEGER, b INTEGER, c INTEGER);
INSERT INTO test_minmax VALUES (1, 10, 42, 25);

SELECT greatest(a, b, c) as result FROM test_minmax;
→ [{"result": 42}]

SELECT least(a, b, c) as result FROM test_minmax;
→ [{"result": 10}]

DROP TABLE test_minmax;

-- Test MIN() and MAX() aggregates
CREATE TABLE test_agg (id INTEGER PRIMARY KEY, int_val INTEGER NULL, real_val REAL NULL);
INSERT INTO test_agg VALUES (1, 42, NULL), (2, 10, NULL), (3, 25, NULL);
INSERT INTO test_agg VALUES (4, NULL, 3.5), (5, NULL, 2.5), (6, NULL, 1.5);

SELECT MIN(int_val) as result FROM test_agg;
→ [{"result": 10}]

SELECT MAX(int_val) as result FROM test_agg;
→ [{"result": 42}]

SELECT MAX(real_val) as result FROM test_agg;
→ [{"result": 3.5}]

DROP TABLE test_agg;

-- Test common type resolution for coalesce()
SELECT coalesce(NULL, 42, 2.5) as result;
→ [{"result": 42}]

-- Test common type resolution for iif()
SELECT iif(1, 42, 2.5) as result;
→ [{"result": 42}]

SELECT iif(0, 42, 2.5) as result;
→ [{"result": 2.5}]

-- Test common type resolution for greatest() and least()
SELECT greatest(10, 2.5, 42) as result;
→ [{"result": 42}]

SELECT least(10, 2.5, 42) as result;
→ [{"result": 2.5}]

-- Test common type resolution for choose()
SELECT choose(1, 42, 2.5, 100) as result;
→ [{"result": 42}]

SELECT choose(2, 42, 2.5, 100) as result;
→ [{"result": 2.5}]

-- Test scalar function type inference
SELECT round(42) as result;
→ [{"result": 42}]

SELECT round(2.5) as result;
→ [{"result": 3}]

SELECT nullif(42, 0) as result;
→ [{"result": 42}]

SELECT nullif(42, 42) as result;
→ [{"result": null}]

SELECT sqrt(16.0) as result;
→ [{"result": 4}]

SELECT floor(2.5) as result;
→ [{"result": 2}]

SELECT ceil(2.5) as result;
→ [{"result": 3}]

SELECT clamp(50, 0, 100) as result;
→ [{"result": 50}]

SELECT clamp(-10, 0, 100) as result;
→ [{"result": 0}]

SELECT clamp(150, 0, 100) as result;
→ [{"result": 100}]

-- Test string function type inference
SELECT length('hello') as result;
→ [{"result": 5}]

SELECT upper('hello') as result;
→ [{"result": "HELLO"}]

SELECT lower('HELLO') as result;
→ [{"result": "hello"}]

SELECT trim('  hello  ') as result;
→ [{"result": "hello"}]

SELECT substr('hello', 1, 3) as result;
→ [{"result": "hel"}]

SELECT replace('hello', 'l', 'L') as result;
→ [{"result": "heLLo"}]

SELECT instr('hello', 'l') as result;
→ [{"result": 3}]

-- Test arithmetic operator type inference
-- INTEGER + INTEGER -> INTEGER
SELECT 10 + 20 as result;
→ [{"result": 30}]

-- INTEGER + REAL -> REAL
SELECT 10 + 2.5 as result;
→ [{"result": 12.5}]

-- REAL + INTEGER -> REAL
SELECT 2.5 + 10 as result;
→ [{"result": 12.5}]

-- REAL + REAL -> REAL
SELECT 2.5 + 3.5 as result;
→ [{"result": 6}]

-- INTEGER * INTEGER -> INTEGER
SELECT 10 * 20 as result;
→ [{"result": 200}]

-- INTEGER * REAL -> REAL
SELECT 10 * 2.5 as result;
→ [{"result": 25}]

-- INTEGER - INTEGER -> INTEGER
SELECT 20 - 10 as result;
→ [{"result": 10}]

-- REAL - INTEGER -> REAL
SELECT 12.5 - 10 as result;
→ [{"result": 2.5}]

-- INTEGER / INTEGER -> INTEGER
SELECT 20 / 10 as result;
→ [{"result": 2}]

-- REAL / INTEGER -> REAL
SELECT 10.0 / 2 as result;
→ [{"result": 5}]

-- INTEGER % INTEGER -> INTEGER
SELECT 23 % 10 as result;
→ [{"result": 3}]

