-- UDF Determinism Tests
-- Tests that user-defined functions properly declare and propagate determinism

-- Test 1: Non-deterministic UDF in DEFAULT should fail
-- (This test would require programmatic UDF registration, so we'll skip it for now)

-- Test 2: Verify built-in non-deterministic functions are rejected
CREATE TABLE t1 (
    id INTEGER PRIMARY KEY,
    created_at TEXT DEFAULT datetime('now')
);
-- error: Non-deterministic expression not allowed in DEFAULT

-- Test 3: Verify built-in deterministic functions are allowed
CREATE TABLE t2 (
    id INTEGER PRIMARY KEY,
    upper_name TEXT DEFAULT upper('test')
);

INSERT INTO t2 (id) VALUES (1);
SELECT * FROM t2;
â†’ [{"id":1,"upper_name":"TEST"}]

DROP TABLE t2;

-- Test 4: Verify random() is rejected in DEFAULT
CREATE TABLE t3 (
    id INTEGER PRIMARY KEY,
    random_val REAL DEFAULT random()
);
-- error: Non-deterministic expression not allowed in DEFAULT

-- Test 5: Verify randomblob() is rejected in DEFAULT
CREATE TABLE t4 (
    id INTEGER PRIMARY KEY,
    random_blob BLOB DEFAULT randomblob(16)
);
-- error: Non-deterministic expression not allowed in DEFAULT

